/* 
WYSIWYG-BBCODE editor
Copyright (c) 2009, Jitbit Sotware, http://www.jitbit.com/
*/
function rep(a,b){content=content.replace(a,b)}function initEditor(a,b){enableWysiwyg=void 0==b||b,""!=a&&(body_id=a),textboxelement=document.getElementById(body_id),textboxelement.setAttribute("class","editorBBCODE"),textboxelement.className="editorBBCODE",enableWysiwyg&&(ifm=document.createElement("iframe"),ifm.setAttribute("id","rte"),ifm.setAttribute("frameborder","0"),ifm.style.width=textboxelement.style.width,ifm.style.height=textboxelement.style.height,textboxelement.parentNode.insertBefore(ifm,textboxelement),textboxelement.style.display="none",ifm?ShowEditor():setTimeout("ShowEditor()",100))}function getStyle(a,b){var c=document.getElementById(a);if(c.currentStyle)var d=c.currentStyle[b];else if(window.getComputedStyle)var d=document.defaultView.getComputedStyle(c,null).getPropertyValue(b);return d}function ShowEditor(){enableWysiwyg&&(editorVisible=!0,content=document.getElementById(body_id).value,myeditor=ifm.contentWindow.document,bbcode2html(),myeditor.designMode="on",myeditor.open(),myeditor.write('<html><head><link href="editor.css" rel="Stylesheet" type="text/css" /></head>'),myeditor.write('<body style="margin:0px 0px 0px 0px" class="editorWYSIWYG">'),myeditor.write(content),myeditor.write("</body></html>"),myeditor.close(),myeditor.attachEvent?(parent.ProcessKeyPress&&myeditor.attachEvent("onkeydown",parent.ProcessKeyPress),myeditor.attachEvent("onkeypress",kp)):myeditor.addEventListener&&(parent.ProcessKeyPress&&myeditor.addEventListener("keydown",parent.ProcessKeyPress,!0),myeditor.addEventListener("keypress",kp,!0)))}function SwitchEditor(){editorVisible?(doCheck(),ifm.style.display="none",textboxelement.style.display="",editorVisible=!1):enableWysiwyg&&ifm&&(ifm.style.display="",textboxelement.style.display="none",ShowEditor(),editorVisible=!0)}function html2bbcode(){rep(/<img\s[^<>]*?src=\"?([^<>]*?)\"?(\s[^<>]*)?\/?>/gi,"[img]$1[/img]"),rep(/<\/(strong|b)>/gi,"[/b]"),rep(/<(strong|b)(\s[^<>]*)?>/gi,"[b]"),rep(/<\/(em|i)>/gi,"[/i]"),rep(/<(em|i)(\s[^<>]*)?>/gi,"[i]"),rep(/<\/u>/gi,"[/u]"),rep(/\n/gi," "),rep(/\r/gi," "),rep(/<u(\s[^<>]*)?>/gi,"[u]"),rep(/<div><br(\s[^<>]*)?>/gi,"<div>"),rep(/<br(\s[^<>]*)?>/gi,"\n"),rep(/<p(\s[^<>]*)?>/gi,""),rep(/<\/p>/gi,"\n"),rep(/<ul>/gi,"[ul]"),rep(/<\/ul>/gi,"[/ul]"),rep(/<ol>/gi,"[ol]"),rep(/<\/ol>/gi,"[/ol]"),rep(/<li>/gi,"[li]"),rep(/<\/li>/gi,"[/li]"),rep(/<\/div>\s*<div([^<>]*)>/gi,"</span>\n<span$1>"),rep(/<div([^<>]*)>/gi,"\n<span$1>"),rep(/<\/div>/gi,"</span>\n"),rep(/&nbsp;/gi," "),rep(/&quot;/gi,'"'),rep(/&amp;/gi,"&");var a,b;do{a=content,rep(/<font\s[^<>]*?color=\"?([^<>]*?)\"?(\s[^<>]*)?>([^<>]*?)<\/font>/gi,"[color=$1]$3[/color]"),a==content&&rep(/<font[^<>]*>([^<>]*?)<\/font>/gi,"$1"),rep(/<a\s[^<>]*?href=\"?([^<>]*?)\"?(\s[^<>]*)?>([^<>]*?)<\/a>/gi,"[url=$1]$3[/url]"),b=content,rep(/<(span|blockquote|pre)\s[^<>]*?style=\"?font-weight: ?bold;?\"?\s*([^<]*?)<\/\1>/gi,"[b]<$1 style=$2</$1>[/b]"),rep(/<(span|blockquote|pre)\s[^<>]*?style=\"?font-weight: ?normal;?\"?\s*([^<]*?)<\/\1>/gi,"<$1 style=$2</$1>"),rep(/<(span|blockquote|pre)\s[^<>]*?style=\"?font-style: ?italic;?\"?\s*([^<]*?)<\/\1>/gi,"[i]<$1 style=$2</$1>[/i]"),rep(/<(span|blockquote|pre)\s[^<>]*?style=\"?font-style: ?normal;?\"?\s*([^<]*?)<\/\1>/gi,"<$1 style=$2</$1>"),rep(/<(span|blockquote|pre)\s[^<>]*?style=\"?text-decoration: ?underline;?\"?\s*([^<]*?)<\/\1>/gi,"[u]<$1 style=$2</$1>[/u]"),rep(/<(span|blockquote|pre)\s[^<>]*?style=\"?text-decoration: ?none;?\"?\s*([^<]*?)<\/\1>/gi,"<$1 style=$2</$1>"),rep(/<(span|blockquote|pre)\s[^<>]*?style=\"?color: ?([^<>]*?);\"?\s*([^<]*?)<\/\1>/gi,"[color=$2]<$1 style=$3</$1>[/color]"),rep(/<(span|blockquote|pre)\s[^<>]*?style=\"?font-family: ?([^<>]*?);\"?\s*([^<]*?)<\/\1>/gi,"[font=$2]<$1 style=$3</$1>[/font]"),rep(/<(blockquote|pre)\s[^<>]*?style=\"?\"? (class=|id=)([^<>]*)>([^<>]*?)<\/\1>/gi,"<$1 $2$3>$4</$1>"),rep(/<pre>([^<>]*?)<\/pre>/gi,"[code]$1[/code]"),rep(/<span\s[^<>]*?style=\"?\"?>([^<>]*?)<\/span>/gi,"$1"),b==content&&(rep(/<span[^<>]*>([^<>]*?)<\/span>/gi,"$1"),b=content)}while(a!=content);rep(/<[^<>]*>/gi,""),rep(/&lt;/gi,"<"),rep(/&gt;/gi,">");do{a=content,rep(/\[(b|i|u)\]\[quote([^\]]*)\]([\s\S]*?)\[\/quote\]\[\/\1\]/gi,"[quote$2][$1]$3[/$1][/quote]"),rep(/\[color=([^\]]*)\]\[quote([^\]]*)\]([\s\S]*?)\[\/quote\]\[\/color\]/gi,"[quote$2][color=$1]$3[/color][/quote]"),rep(/\[(b|i|u)\]\[code\]([\s\S]*?)\[\/code\]\[\/\1\]/gi,"[code][$1]$2[/$1][/code]"),rep(/\[color=([^\]]*)\]\[code\]([\s\S]*?)\[\/code\]\[\/color\]/gi,"[code][color=$1]$2[/color][/code]")}while(a!=content);do{a=content,rep(/\[b\]\[\/b\]/gi,""),rep(/\[i\]\[\/i\]/gi,""),rep(/\[u\]\[\/u\]/gi,""),rep(/\[quote[^\]]*\]\[\/quote\]/gi,""),rep(/\[code\]\[\/code\]/gi,""),rep(/\[url=([^\]]+)\]\[\/url\]/gi,""),rep(/\[img\]\[\/img\]/gi,""),rep(/\[color=([^\]]*)\]\[\/color\]/gi,"")}while(a!=content)}function bbcode2html(){rep(/\</gi,"&lt;"),rep(/\>/gi,"&gt;"),rep(/\n/gi,"<br />"),rep(/\[ul\]/gi,"<ul>"),rep(/\[\/ul\]/gi,"</ul>"),rep(/\[ol\]/gi,"<ol>"),rep(/\[\/ol\]/gi,"</ol>"),rep(/\[li\]/gi,"<li>"),rep(/\[\/li\]/gi,"</li>"),browser?(rep(/\[b\]/gi,"<strong>"),rep(/\[\/b\]/gi,"</strong>"),rep(/\[i\]/gi,"<em>"),rep(/\[\/i\]/gi,"</em>"),rep(/\[u\]/gi,"<u>"),rep(/\[\/u\]/gi,"</u>")):(rep(/\[b\]/gi,'<span style="font-weight: bold;">'),rep(/\[i\]/gi,'<span style="font-style: italic;">'),rep(/\[u\]/gi,'<span style="text-decoration: underline;">'),rep(/\[\/(b|i|u)\]/gi,"</span>")),rep(/\[img\]([^\"]*?)\[\/img\]/gi,'<img src="$1" />');var a;do{a=content,rep(/\[url=([^\]]+)\]([\s\S]*?)\[\/url\]/gi,'<a href="$1">$2</a>'),rep(/\[url\]([\s\S]*?)\[\/url\]/gi,'<a href="$1">$1</a>'),browser?(rep(/\[color=([^\]]*?)\]([\s\S]*?)\[\/color\]/gi,'<font color="$1">$2</font>'),rep(/\[font=([^\]]*?)\]([\s\S]*?)\[\/font\]/gi,'<font face="$1">$2</font>')):(rep(/\[color=([^\]]*?)\]([\s\S]*?)\[\/color\]/gi,'<span style="color: $1;">$2</span>'),rep(/\[font=([^\]]*?)\]([\s\S]*?)\[\/font\]/gi,'<span style="font-family: $1;">$2</span>')),rep(/\[code\]([\s\S]*?)\[\/code\]/gi,"<pre>$1</pre>&nbsp;")}while(a!=content)}function doCheck(){editorVisible||ShowEditor(),content=myeditor.body.innerHTML,html2bbcode(),document.getElementById(body_id).value=content}function stopEvent(a){return a||window.event,a.stopPropagation?(a.stopPropagation(),a.preventDefault()):void 0!==a.cancelBubble&&(a.cancelBubble=!0,a.returnValue=!1),!1}function doQuote(){if(editorVisible)if(ifm.contentWindow.focus(),isIE){textRange=ifm.contentWindow.document.selection.createRange();var a="[quote=]"+textRange.text+"[/quote]";textRange.text=a}else{var b=ifm.contentWindow.getSelection().getRangeAt(0),c=b.toString();b.deleteContents(),b.insertNode(document.createTextNode("[quote=]"+c+"[/quote]"))}else AddTag("[quote=]","[/quote]")}function doCode(){if(editorVisible)if(ifm.contentWindow.focus(),isIE){textRange=ifm.contentWindow.document.selection.createRange();var a="[code]"+textRange.text+"[/code]";textRange.text=a}else{var b=ifm.contentWindow.getSelection().getRangeAt(0),c=b.toString();b.deleteContents(),b.insertNode(document.createTextNode("[code]"+c+"[/code]"))}else AddTag("[code]","[/code]")}function kp(a){if(isIE)var b=a.keyCode;else var b=a.which;if(13==b){if(isIE){var c=myeditor.selection.createRange();if("li"!=c.parentElement().tagName.toLowerCase())return c.pasteHTML("<br/>"),c.move("character")&&c.move("character",-1),c.select(),stopEvent(a),!1}}else enter=0}function InsertSmile(a){InsertText(a),document.getElementById("divSmilies").style.display="none"}function InsertYoutube(){InsertText("http://www.youtube.com/watch?v=XXXXXXXXXXX")}function InsertText(a){editorVisible?insertHtml(a):textboxelement.value+=a}function doClick(a){if(editorVisible)ifm.contentWindow.focus(),myeditor.execCommand(a,!1,null);else switch(a){case"bold":AddTag("[b]","[/b]");break;case"italic":AddTag("[i]","[/i]");break;case"underline":AddTag("[u]","[/u]");break;case"InsertUnorderedList":AddTag("[ul][li]","[/li][/ul]")}}function doColor(a){ifm.contentWindow.focus(),isIE&&(textRange=ifm.contentWindow.document.selection.createRange(),textRange.select()),myeditor.execCommand("forecolor",!1,a)}function doLink(){if(editorVisible){ifm.contentWindow.focus();var a=prompt("Enter a URL:","http://");if(null!=a&&""!=a)if(isIE){var b=ifm.contentWindow.document.selection.createRange();""==b.text?b.pasteHTML("<a href='"+a+"'>"+a+"</a>"):myeditor.execCommand("CreateLink",!1,a)}else if(window.getSelection){var c=ifm.contentWindow.getSelection().getRangeAt(0);0==c.toString().length?myeditor.execCommand("inserthtml",!1,"<a href='"+a+"'>"+a+"</a>"):myeditor.execCommand("CreateLink",!1,a)}else myeditor.execCommand("CreateLink",!1,a)}else AddTag("[url=","]click here[/url]")}function doImage(){editorVisible?(ifm.contentWindow.focus(),myimg=prompt("Enter Image URL:","http://"),null!=myimg&&""!=myimg&&myeditor.execCommand("InsertImage",!1,myimg)):AddTag("[img]","[/img]")}function insertHtml(a){ifm.contentWindow.focus(),isIE?ifm.contentWindow.document.selection.createRange().pasteHTML(a):myeditor.execCommand("inserthtml",!1,a)}function MozillaInsertText(a,b,c){a.value=a.value.slice(0,c)+b+a.value.slice(c)}function AddTag(a,b){var c=textboxelement;if(isIE){if(document.selection){c.focus();var d=c.value,e=document.selection.createRange();""==e.text?e.text=a+b:d.indexOf(e.text)>=0?e.text=a+e.text+b:c.value=d+a+b,e.select()}}else if(void 0!==c.selectionStart){var f=c.selectionStart,g=c.selectionEnd;MozillaInsertText(c,a,f),MozillaInsertText(c,b,g+a.length),c.selectionStart=f,c.selectionEnd=g+a.length+b.length,c.focus()}else c.value=c.value+a+b}function getScrollY(){var b=0;return"number"==typeof window.pageYOffset?(b=window.pageYOffset,window.pageXOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(b=document.body.scrollTop,document.body.scrollLeft):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(b=document.documentElement.scrollTop,document.documentElement.scrollLeft),b}function getTop2(){return csBrHt=0,"number"==typeof window.innerWidth?csBrHt=window.innerHeight:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?csBrHt=document.documentElement.clientHeight:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(csBrHt=document.body.clientHeight),ctop=csBrHt/2-115+getScrollY(),ctop}function getLeft2(){var a=0;return"number"==typeof window.innerWidth?a=window.innerWidth:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?a=document.documentElement.clientWidth:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(a=document.body.clientWidth),cleft=a/2-125,cleft}function setCCbldID2(a){editorVisible?doColor(a):AddTag("[color="+a+"]","[/color]")}function setCCbldSty2(a,b,c){switch(b){case"bc":"none"!=a&&(document.getElementById(a).style.backgroundColor=c);break;case"vs":document.getElementById(a).style.visibility=c;break;case"ds":document.getElementById(a).style.display=c;break;case"tp":document.getElementById(a).style.top=c;break;case"lf":document.getElementById(a).style.left=c}}function putOBJxColor2(a,b,c){"x"!=b&&(setCCbldID2(b,c),setCCbldSty2(a,"bc",b)),setCCbldSty2("colorpicker201","vs","hidden"),setCCbldSty2("colorpicker201","ds","none")}function showColorGrid2(a,b){var c=new Array("00","55","AA","FF"),d=0,e='"'+a+'","x", "'+b+'"',f="";f+='<table bgcolor="#FFFFFF" border="0" cellpadding="0" cellspacing="0" style="border:solid 0px #F0F0F0;padding:2px;"><tr>',f+="<td colspan='9' align='left' style='margin:0;padding:2px;height:12px;' ><input class='o5582n66' type='text' size='12' id='o5582n66' value='#FFFFFF'><input class='o5582n66a' type='text' size='2' style='width:14px;' id='o5582n66a' onclick='javascript:alert(\"click on selected swatch below...\");' value='' style='border:solid 1px #666;'></td><td colspan='9' align='right'><a class='o5582n66' href='javascript:onclick=putOBJxColor2("+e+")'><span class='a01p3'>"+clos1+"</span></a></td></tr><tr>";for(v=0;v<2;++v)for(o=0;o<4;o++)for(f+="</tr><tr>",y=2*v;y<2+2*v;y++)for(x=0;x<4;x++){var h="";h=c[o]+c[y]+c[x];var i="'"+a+"','"+h+"', '"+b+"'";f+='<td class="o5582brd" style="background-color:#'+h+'"><a class="o5582n66"  href="javascript:onclick=putOBJxColor2('+i+');" onmouseover=javascript:document.getElementById("o5582n66").value="#'+h+'";javascript:document.getElementById("o5582n66a").style.backgroundColor="#'+h+'";  title="#'+h+'"><div style="width:12px;height:14px;"></div></a></td>',d++}f+="</tr></table>",document.getElementById("colorpicker201").innerHTML=f,setCCbldSty2("colorpicker201","vs","visible"),setCCbldSty2("colorpicker201","ds","inline")}var myeditor,ifm,body_id="textareaEd",textboxelement,content,isIE=/msie|MSIE/.test(navigator.userAgent),isChrome=/Chrome/.test(navigator.userAgent),isSafari=/Safari/.test(navigator.userAgent)&&!isChrome,browser=isIE||window.opera,textRange,enter=0,editorVisible=!1,enableWysiwyg=!1;document.write("<style type='text/css'>.colorpicker201{visibility:hidden;display:none;position:absolute;background:#FFF;z-index:999;filter:progid:DXImageTransform.Microsoft.Shadow(color=#D0D0D0,direction=135);}.o5582brd{padding:0;width:12px;height:14px;border-bottom:solid 1px #DFDFDF;border-right:solid 1px #DFDFDF;}a.o5582n66,.o5582n66,.o5582n66a{font-family:arial,tahoma,sans-serif;text-decoration:underline;font-size:9px;color:#666;border:none;}.o5582n66,.o5582n66a{text-align:center;text-decoration:none;}a:hover.o5582n66{text-decoration:none;color:#FFA500;cursor:pointer;}.a01p3{padding:1px 4px 1px 2px;background:whitesmoke;border:solid 1px #DFDFDF;}</style>");var nocol1="&#78;&#79;&#32;&#67;&#79;&#76;&#79;&#82;",clos1="X";
